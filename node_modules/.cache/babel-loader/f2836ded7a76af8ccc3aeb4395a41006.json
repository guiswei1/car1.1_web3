{"ast":null,"code":"var _jsxFileName = \"/Users/lcst/hv/hv1.1-web3/src/App.js\";\nimport React, { Component } from 'react';\nimport Web3 from \"web3\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n\n    this.GetterPendingItem = () => {\n      window.myContract.methods.getPendingItem().call({\n        from: window.defaultAccount\n      }).then(value => {\n        console.log(value.Pending);\n        console.log(value.totalPledge);\n        this.setState({\n          totalPledge: value[1],\n          pending: [2]\n        });\n      });\n    };\n\n    this.Pending = () => {\n      var newPending = document.getElementById('pending').value;\n      window.myContract.methods.pending(newPending).send().on('transactionHash', transactionHash => {\n        console.log('transactionHash', transactionHash);\n      }).on('confirmation', (confirmationNumber, receipt) => {\n        console.log({\n          confirmationNumber: confirmationNumber,\n          receipt: receipt\n        });\n      }).on('receipt', receipt => {\n        console.log({\n          receipt: receipt\n        });\n      }).on('error', (error, receipt) => {\n        console.log({\n          error: error,\n          receipt: receipt\n        });\n      });\n    };\n\n    this.state = {\n      totalPledge: 0,\n      pending: 0\n    };\n  }\n\n  async componentDidMount() {\n    //判断页面是否安装Metamask\n    if (typeof window.ethereum !== 'undefined') {\n      const ethereum = window.ethereum; //禁止自动刷新，metamask要求写的\n\n      ethereum.autoRefreshOnNetworkChange = false;\n\n      try {\n        //第一次链接Metamask\n        const accounts = await ethereum.enable();\n        console.log(accounts); //初始化Provider\n\n        const provider = window['ethereum'];\n        console.log(provider); //获取网络ID\n\n        console.log(provider.chainId); //实例化Web3\n\n        const web3 = new Web3(provider);\n        console.log(web3); //导入abi文件\n\n        const abi = require(\"./contract.abi.json\"); //定义合约地址\n\n\n        const address = \"0xb2eDFE0069A54E5937F7e01bD916f74Ae1C73e1C\"; //实例化合约\n\n        window.myContract = new web3.eth.Contract(abi.abi, address);\n        console.log(window.myContract);\n        window.defaultAccount = accounts[0].toLowerCase();\n        console.log(window.defaultAccount);\n        ethereum.on('accountsChanged', function (accounts) {\n          console.log(\"accountsChanged:\" + accounts);\n        });\n        ethereum.on('networkChanged', function (networkVersion) {\n          console.log(\"networkChanged:\" + networkVersion);\n        });\n      } catch (e) {}\n    } else {\n      console.log('没有metamask');\n    }\n  } //查询质押信息\n\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"label\", {\n          children: \"\\u8D28\\u62BC\\u6570\\u989D:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 84,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          id: \"totalPledge\",\n          children: [\" \", this.state.totalPledge]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 84,\n          columnNumber: 32\n        }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n          children: \":\\u4ECA\\u65E5\\u5F85\\u9886\\u53D6\\u6570\\u989D\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 85,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n          id: \"pending\",\n          children: this.state.pending\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 85,\n          columnNumber: 37\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 87,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => {\n            this.GetterPendingItem();\n          },\n          children: \"\\u67E5\\u8D28\\u62BC\\u4FE1\\u606F\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 89,\n          columnNumber: 9\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => {\n            this.Pending();\n          },\n          children: \"\\u4ECA\\u65E5\\u5F85\\u9886\\u53D6\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 92,\n          columnNumber: 9\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 91,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 82,\n      columnNumber: 5\n    }, this);\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/lcst/hv/hv1.1-web3/src/App.js"],"names":["React","Component","Web3","App","constructor","props","GetterPendingItem","window","myContract","methods","getPendingItem","call","from","defaultAccount","then","value","console","log","Pending","totalPledge","setState","pending","newPending","document","getElementById","send","on","transactionHash","confirmationNumber","receipt","error","state","componentDidMount","ethereum","autoRefreshOnNetworkChange","accounts","enable","provider","chainId","web3","abi","require","address","eth","Contract","toLowerCase","networkVersion","e","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport Web3 from \"web3\";\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      totalPledge:0,\n      pending:0\n    };\n  }\nasync componentDidMount() {\n  //判断页面是否安装Metamask\n  if (typeof window.ethereum !== 'undefined') {\n    const ethereum = window.ethereum\n    //禁止自动刷新，metamask要求写的\n    ethereum.autoRefreshOnNetworkChange = false\n\n    try {\n      //第一次链接Metamask\n      const accounts = await ethereum.enable()\n      console.log(accounts)\n      //初始化Provider\n      const provider = window['ethereum']\n      console.log(provider)\n      //获取网络ID\n      console.log(provider.chainId)\n      //实例化Web3\n      const web3 = new Web3(provider)\n      console.log(web3)\n      //导入abi文件\n      const abi = require(\"./contract.abi.json\")\n      //定义合约地址\n      const address = \"0xb2eDFE0069A54E5937F7e01bD916f74Ae1C73e1C\"\n      //实例化合约\n      window.myContract = new web3.eth.Contract(abi.abi,address)\n      console.log(window.myContract)\n      window.defaultAccount = accounts[0].toLowerCase()\n      console.log(window.defaultAccount)\n\n      ethereum.on('accountsChanged', function (accounts) {\n        console.log(\"accountsChanged:\" + accounts)\n      })\n      ethereum.on('networkChanged', function (networkVersion) {\n        console.log(\"networkChanged:\" + networkVersion)\n      })\n    } catch (e) {\n\n    }\n  } else {\n    console.log('没有metamask')\n  }\n}\n//查询质押信息\nGetterPendingItem = () => {\n  window.myContract.methods.getPendingItem().call({from:window.defaultAccount}).then(value=>{\n \n    console.log(value.Pending)\n    console.log(value.totalPledge)\n    this.setState({totalPledge:value[1],pending:[2]})\n  })\n}\n\n //今日待领取\nPending =() =>{  \n  var newPending = document.getElementById('pending').value;\n  window.myContract.methods.pending(newPending).send()\n  .on('transactionHash',(transactionHash)=>{\n    console.log('transactionHash',transactionHash)\n  })\n  .on('confirmation',(confirmationNumber,receipt)=>{\n    console.log({ confirmationNumber: confirmationNumber, receipt: receipt })\n  })\n  .on('receipt',(receipt)=>{\n    console.log({ receipt: receipt })\n  })\n  .on('error',(error,receipt)=>{\n    console.log({ error: error, receipt: receipt })\n  })\n}\nrender() {\n  return (\n    <div>\n        <div >\n          <label >质押数额:</label><span id=\"totalPledge\" > {this.state.totalPledge}</span> \n            <label >:今日待领取数额</label><span id=\"pending\" >{this.state.pending}</span>\n         </div>\n      <div></div>\n      <div>\n        <button onClick={() => { this.GetterPendingItem() }}>查质押信息</button>\n      </div>\n      <div>\n        <button onClick={() => { this.Pending() }}>今日待领取</button>\n      </div>\n      <div></div>\n    </div>\n  );\n}\n}export default App;"]},"metadata":{},"sourceType":"module"}