{"ast":null,"code":"var _jsxFileName = \"/Users/lcst/car1.1/car1.1-web3/src/App.js\";\nimport React, { Component } from 'react';\nimport Web3 from \"web3\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nclass App extends Component {\n  constructor(props) {\n    super(props);\n\n    this.StakingSetApprovalForAll = () => {\n      window.nMyContract.methods.setApprovalForAll(window.tAddress, true).send({\n        from: window.defaultAccount\n      }).on('transactionHash', transactionHash => {\n        console.log('transactionHash', transactionHash);\n      }).on('confirmation', (confirmationNumber, receipt) => {\n        console.log({\n          confirmationNumber: confirmationNumber,\n          receipt: receipt\n        }); //刷新待释放数据\n\n        if (confirmationNumber == 21) {\n          window.myContract.methods.withrawable(window.defaultAccount).call({\n            from: window.defaultAccount\n          }).then(value => {\n            console.log(value);\n            this.setState({\n              withrawable: value * Math.pow(10, -18)\n            });\n          });\n        }\n      }); //----------------------------------------------------------------------\n    };\n\n    this.state = {\n      value: 0\n    };\n  } //链接钱包\n\n\n  async componentDidMount() {\n    //判断页面是否安装Metamask\n    if (typeof window.ethereum !== 'undefined') {\n      const ethereum = window.ethereum; //禁止自动刷新，metamask要求写的\n\n      ethereum.autoRefreshOnNetworkChange = false;\n\n      try {\n        //第一次链接Metamask\n        const accounts = await ethereum.enable();\n        console.log(accounts); //初始化Provider\n\n        const provider = window['ethereum'];\n        console.log(provider); //获取网络ID\n\n        console.log(provider.chainId); //实例化Web3\n\n        const web3 = new Web3(provider);\n        console.log(web3); // ---------------------定义n车型--------------------\n        //导入abi文件\n\n        const nAbi = require(\"./abi/NTierCar.json\"); //定义N车型合约地址\n\n\n        const nAddress = \"0xc29270cf76D77f1840e7ED67B9C4EB68aC815e14\"; //实例化合约\n\n        window.nMyContract = new web3.eth.Contract(nAbi, nAddress);\n        console.log(window.nMyContract); //--------------------------END -----------------------\n        //------------------------定义质押---------------------\n        //导入abi文件\n\n        const tAbi = require(\"./abi/Staking.json\"); //定义N车型合约地址\n\n\n        window.tAddress = \"0x7FC006357fc0EC1602f13d2FADe179b11f5C8056\"; //实例化合约\n\n        window.tMyContract = new web3.eth.Contract(tAbi, window.tAddress);\n        console.log(window.tMyContract); //--------------------------END -----------------------\n\n        window.defaultAccount = accounts[0].toLowerCase();\n        console.log(window.defaultAccount);\n        ethereum.on('accountsChanged', function (accounts) {\n          console.log(\"accountsChanged:\" + accounts);\n        });\n        ethereum.on('networkChanged', function (networkVersion) {\n          console.log(\"networkChanged:\" + networkVersion);\n        });\n      } catch (e) {}\n    } else {\n      console.log('没有metamask');\n    } // 请求待释放数据\n\n  } // ------------------------1、质押--------------------------------------------------------\n  //授权\n\n\n  render() {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: [\" \", /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => {\n            this.StakingSetApprovalForAll();\n          },\n          children: \"\\u8D28\\u62BC\\u6388\\u6743\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 7\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 5\n    }, this);\n  }\n\n}\n\nexport default App;","map":{"version":3,"sources":["/Users/lcst/car1.1/car1.1-web3/src/App.js"],"names":["React","Component","Web3","App","constructor","props","StakingSetApprovalForAll","window","nMyContract","methods","setApprovalForAll","tAddress","send","from","defaultAccount","on","transactionHash","console","log","confirmationNumber","receipt","myContract","withrawable","call","then","value","setState","Math","pow","state","componentDidMount","ethereum","autoRefreshOnNetworkChange","accounts","enable","provider","chainId","web3","nAbi","require","nAddress","eth","Contract","tAbi","tMyContract","toLowerCase","networkVersion","e","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport Web3 from \"web3\";\nclass App extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      value:0\n    };\n  }\n\n  //链接钱包\n  async componentDidMount() {\n    //判断页面是否安装Metamask\n    if (typeof window.ethereum !== 'undefined') {\n      const ethereum = window.ethereum\n      //禁止自动刷新，metamask要求写的\n      ethereum.autoRefreshOnNetworkChange = false\n\n      try {\n        //第一次链接Metamask\n        const accounts = await ethereum.enable()\n        console.log(accounts)\n        //初始化Provider\n        const provider = window['ethereum']\n        console.log(provider)\n        //获取网络ID\n        console.log(provider.chainId)\n        //实例化Web3\n        const web3 = new Web3(provider)     \n        console.log(web3)\n\n        // ---------------------定义n车型--------------------\n        //导入abi文件\n        const nAbi = require(\"./abi/NTierCar.json\")\n        //定义N车型合约地址\n        const nAddress = \"0xc29270cf76D77f1840e7ED67B9C4EB68aC815e14\"\n        //实例化合约\n        window.nMyContract = new web3.eth.Contract(nAbi,nAddress)\n        console.log(window.nMyContract)\n        //--------------------------END -----------------------\n\n        //------------------------定义质押---------------------\n        //导入abi文件\n        const tAbi = require(\"./abi/Staking.json\")\n        //定义N车型合约地址\n        window.tAddress = \"0x7FC006357fc0EC1602f13d2FADe179b11f5C8056\"\n        //实例化合约\n        window.tMyContract = new web3.eth.Contract(tAbi,window.tAddress)\n        console.log(window.tMyContract)\n        //--------------------------END -----------------------\n\n\n\n        window.defaultAccount = accounts[0].toLowerCase()\n        console.log(window.defaultAccount)\n\n        ethereum.on('accountsChanged', function (accounts) {\n          console.log(\"accountsChanged:\" + accounts)\n        })\n        ethereum.on('networkChanged', function (networkVersion) {\n          console.log(\"networkChanged:\" + networkVersion)\n        })\n      } catch (e) {\n\n      }\n    } else {\n      console.log('没有metamask')\n    }\n    // 请求待释放数据\n\n\n  }\n\n  // ------------------------1、质押--------------------------------------------------------\n  //授权\n  StakingSetApprovalForAll =() =>{ \n    window.nMyContract.methods.setApprovalForAll(window.tAddress,true).send({from:window.defaultAccount})\n  .on('transactionHash',(transactionHash)=>{\n    console.log('transactionHash',transactionHash)\n  })\n  .on('confirmation',(confirmationNumber,receipt)=>{\n    console.log({ confirmationNumber: confirmationNumber, receipt: receipt })\n    //刷新待释放数据\n    if(confirmationNumber ==21){\n      window.myContract.methods.withrawable(window.defaultAccount).call({from:window.defaultAccount}).then(value=>{\n        console.log(value)\n        this.setState({withrawable:value * Math.pow(10,-18)})\n      })\n    }\n  })\n  //----------------------------------------------------------------------\n}\n\n\n\n\n\n\nrender() {\n  \n  return (\n    <div>\n      <div> <button onClick={() => { this.StakingSetApprovalForAll() }}>质押授权</button></div>\n      <div></div>\n    </div>\n  );\n}\n}export default App;"]},"metadata":{},"sourceType":"module"}